# Схема базы данных Theatre-App

Документ описывает актуальную структуру данных, предполагаемую для поддержки пользовательских ролей и расписания. Таблицы представлены в стиле реляционной СУБД (PostgreSQL/SQL Server).

## 1. Таблица `users` (уже существует)

| Поле          | Тип                | Описание                                                     |
|---------------|--------------------|--------------------------------------------------------------|
| `login`       | `varchar` (PK)     | Уникальный логин, служит первичным ключом.                   |
| `password`    | `varchar`          | Хеш пароля.                                                  |
| `full_name`   | `varchar`          | ФИО пользователя.                                            |
| `role`        | `varchar`          | Роль (admin, artist, director, worker, technical …).         |
| `email`       | `varchar`          | Контактный e-mail.                                           |
| `phone`       | `varchar`          | Контактный телефон.                                          |
| `bio`         | `text`             | Описание/биография артиста.                                  |
| `photo_path`  | `varchar`          | Путь к загруженной фотографии (относительный URL).           |
| `created_at`  | `timestamp`        | Дата регистрации.                                            |
| `updated_at`  | `timestamp`        | Последнее обновление профиля.                                |

Все данные об артистах и других сотрудниках хранятся именно здесь.

## 2. Таблицы, необходимые для расписания

### 2.1 `stages`

Хранит список площадок/сцен, которые отображаются в расписании (Большая сцена, Малая сцена и т.д.).

| Поле        | Тип            | Описание                             |
|-------------|----------------|--------------------------------------|
| `id`        | `serial` (PK)  | Уникальный идентификатор сцены.      |
| `name`      | `varchar`      | Отображаемое название сцены.         |
| `slug`      | `varchar`      | Служебное имя (например, `main`).    |
| `capacity`  | `int` NULL     | Опционально: вместимость.            |
| `color_hex` | `varchar` NULL | Цвет для UI по умолчанию.            |
| `created_at`| `timestamp`    | Дата создания записи.                |

### 2.2 `productions`

Справочник постановок/мероприятий. Позволяет переиспользовать одну постановку в разных датах.

| Поле         | Тип            | Описание                                          |
|--------------|----------------|---------------------------------------------------|
| `id`         | `serial` (PK)  | Уникальный идентификатор постановки.              |
| `title`      | `varchar`      | Название (например, «Гадкий утенок»).             |
| `description`| `text` NULL    | Краткое описание.                                 |
| `duration`   | `interval` NULL| Длительность по умолчанию.                        |
| `age_limit`  | `varchar` NULL | Возрастное ограничение (6+, 12+ ...).             |
| `created_at` | `timestamp`    | Дата создания.                                    |

### 2.3 `schedule_events`

Основная таблица расписания. Каждая запись — конкретное событие на сцене в определённый день.

| Поле            | Тип             | Описание                                                                      |
|-----------------|-----------------|--------------------------------------------------------------------------------|
| `id`            | `serial` (PK)   | Уникальный идентификатор события.                                             |
| `stage_id`      | `int` (FK→stages.id) | Сцена, на которой проходит событие.                                    |
| `production_id` | `int` NULL (FK→productions.id) | Базовая постановка (может быть NULL для разовых событий).  |
| `title`         | `varchar`       | Отображаемое название (если не используется справочник).                      |
| `event_type`    | `varchar`       | Тип: performance, rehearsal, workshop, meeting и т.п.                         |
| `date`          | `date`          | День проведения.                                                               |
| `time_start`    | `time`          | Время начала.                                                                  |
| `time_end`      | `time`          | Время окончания.                                                               |
| `color_hex`     | `varchar` NULL  | (Опционально) цвет карточки в UI.                                              |
| `status`        | `varchar`       | planned / confirmed / canceled …                                               |
| `notes`         | `text` NULL     | Комментарии (тех. требования и т.п.).                                          |
| `created_by`    | `varchar` (FK→users.login) | Кто создал запись.                                                   |
| `updated_by`    | `varchar` (FK→users.login) | Кто последний редактировал.                                           |
| `created_at`    | `timestamp`     | Когда создано.                                                                 |
| `updated_at`    | `timestamp`     | Когда обновлено.                                                               |

**Индексы:** `(date, stage_id)` для быстрой выборки по дате и сцене; `(production_id, date)` для аналитики по постановкам.

### 2.4 `event_participants`

Связующая таблица «кто участвует в событии». Позволяет выдавать артистов/техников по ролям.

| Поле            | Тип                          | Описание                                      |
|-----------------|------------------------------|-----------------------------------------------|
| `event_id`      | `int` (FK→schedule_events.id)| Ссылка на событие.                             |
| `user_login`    | `varchar` (FK→users.login)   | Участник события.                              |
| `responsibility`| `varchar`                    | Роль: actor, director, technician, host …      |
| `notes`         | `text` NULL                  | Доп. комментарий (например, «дубль»).          |

PK можно сделать составным `(event_id, user_login, responsibility)`.

### 2.5 `event_assets` (опционально)

Для хранения файлов/документов (сценарии, схемы света).

| Поле         | Тип                     | Описание                                      |
|--------------|-------------------------|-----------------------------------------------|
| `id`         | `serial` (PK)           | Уникальный идентификатор.                     |
| `event_id`   | `int` (FK→schedule_events.id) | Привязка к событию.                     |
| `file_path`  | `varchar`               | Путь или URL к файлу.                         |
| `label`      | `varchar`               | Подпись (например, «Партитура»).              |
| `uploaded_by`| `varchar` (FK→users.login) | Кто загрузил.                               |
| `uploaded_at`| `timestamp`             | Когда загружено.                              |

## 3. Рекомендации по использованию

1. **Чтение расписания.**  
   Для месячного/недельного вида выполняется запрос `SELECT * FROM schedule_events WHERE date BETWEEN ? AND ? ORDER BY date, time_start;` с джойнами на `stages` и `productions`.

2. **Редактирование.**  
   - Админ UI создаёт/правит записи `schedule_events`.  
   - При необходимости добавляются участники через `event_participants`.

3. **Права доступа.**  
   - Таблица `users` определяет роль.  
   - Проверка ролей выполняется на API-слое, чтобы создавать/изменять расписание могли только администраторы и авторизованные сотрудники.

Такой набор таблиц покрывает текущие потребности (карточки расписания, сцены, участники) и оставляет пространство для роста функциональности.***
